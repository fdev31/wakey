<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="style.css"/>

        <meta charset="utf-8" />
        <title>TO simulator</title>
    </head>
    <body onresize="size_changed()">
        <header>
            <a href="https://github.com/fdev31/wakey">get code and contribute !</a>
            <div class="helpgroup">
                <div class="helpitem">
                    <h1>button <em>[number]</em></h1>
                    Number is a mouse button (1 = left, 2 = middle, 3 = right)
                    <br/>
                    <em>You can ommit "button" and just give the button number</em>
                </div>
                <div class="helpitem">
                    <h1>key <em>[name]</em></h1>
                    Modifiers: ctrl, alt, shift, super, etc...<br/>
                    Keys: tab, backspace, del, home, PgUp, Esc, up, a, b, c...<br/>
                    <em>Exemple:</em> <tt>key +ctrl button 5 key -ctrl</tt> <br/>
                    <b>+</b>: key press, <b>-</b>: key release
                </div>
                <div class="helpitem">
                    <h1>modetoggle</h1>
                    Switch between relative and absolute mode
                </div>
            </div>
        </header>
        <article>
            <section>
                <aside>
                    <div id="diagram" style="display: none">
                    </div>
                </aside>
            </section>
<hr/>
            <div id="input_zone" style="display: none">
Paste code execution output here:<br/>
                <button style="float: right;" type="button" onclick="import_config()" >Load</button>
                <button style="float: right; clear: both;" type="button" onclick="$('#device_description').val('')" >Clear</button>
                <textarea style="flush: right" id="device_description" cols="100" rows="5"></textarea>
            </div>
            <div id="sourcecode" class=""></div>
<hr/>
<h1>Instructions</h1>
<ul>
<li>Copy and paste the code below inside your terminal</li>
<li>Copy the terminal output inside the text area above</li>
<li>Press "Load"</li>
<li>Edit values in the diagram</li>
<li>Press "Export" to get the configuration script output</li>
</ul>
<button onclick="show_app()">Ok, proceed</button>
<h2>Code:</h2>
            <pre id="extractor">
cat &lt;&lt;EOF | python -
import subprocess
import json
import re

models = subprocess.Popen(['xsetwacom', '--list'], stdout=subprocess.PIPE).communicate()[0].split(b'\n')
devices = {}
pr_re = re.compile("\\+([a-zA-Z]+) -\\\\1")
final_format = {}

def get_device_properties(device_name):
    raw = subprocess.Popen(['xsetwacom', '-s', '--get', device_name,  'all'], stdout=subprocess.PIPE, stderr=subprocess.PIPE).communicate()
    buttons = {}
    for line in raw[0].split(b'\n'):
        if b'"Button"' in line:
            line = line[line.index(b"Butt")+8:].decode('utf-8')
            but = line.split('"')[1::2]
            buttons[but[0]] = but[1].strip()
    return buttons

for model in models:
    if len(model) &lt; 10:
        continue
    model = model.decode('utf-8').strip()
    model_info = model.split('\t')
    fullname = model_info[0]
    params = dict( p.split(': ') for p in model_info[1:] )
    for typename in 'Finger Pen Pad'.split():
        i = fullname.find(typename)
        if i != -1:
            shortname = fullname[:i-1]
            break
    else:
        print('Unable to find real device name')

    params['name'] = fullname.strip()

    if shortname not in devices:
        devices[shortname] = []

    devices[shortname].append(params)

for name, devices_info in devices.items():
    button_binding = {}
    for device in devices_info:
        buttons = get_device_properties(device['id'])
        dev = {"%s:%s"%(device['type'], but_name) : pr_re.sub("\\\\1", binding) for but_name, binding in buttons.items()}
        button_binding[device['name']] = dev
    final_format[name] = button_binding

print('\n\nCopy the line below:\n====================\n')
print(json.dumps(final_format) + '\n')
EOF
</pre>
        </article>

        <!-- code -->
        <script src="snap.svg-min.js"></script>
        <script src="zepto.min.js"></script>
        <script src="code.js"></script>
    </body>
</html>
